# CHá»¨C NÄ‚NG Gá»¢I Ã CÃ NHÃ‚N HÃ“A
## Há»‡ thá»‘ng Äáº·t phÃ²ng KhÃ¡ch sáº¡n

---

## 1. GIá»šI THIá»†U

### 1.1. Tá»•ng quan
Chá»©c nÄƒng **Gá»£i Ã½ CÃ¡ nhÃ¢n hÃ³a** lÃ  má»™t tÃ­nh nÄƒng thÃ´ng minh sá»­ dá»¥ng cÃ´ng nghá»‡ AI (OpenAI GPT-4o-mini) Ä‘á»ƒ phÃ¢n tÃ­ch lá»‹ch sá»­ Ä‘áº·t phÃ²ng cá»§a ngÆ°á»i dÃ¹ng vÃ  Ä‘Æ°a ra cÃ¡c gá»£i Ã½ phÃ²ng khÃ¡ch sáº¡n phÃ¹ há»£p vá»›i sá»Ÿ thÃ­ch cÃ¡ nhÃ¢n.

### 1.2. Má»¥c tiÃªu
- **CÃ¡ nhÃ¢n hÃ³a tráº£i nghiá»‡m**: ÄÆ°a ra gá»£i Ã½ phÃ¹ há»£p vá»›i tá»«ng ngÆ°á»i dÃ¹ng
- **TÄƒng tá»· lá»‡ chuyá»ƒn Ä‘á»•i**: GiÃºp ngÆ°á»i dÃ¹ng tÃ¬m Ä‘Æ°á»£c phÃ²ng phÃ¹ há»£p nhanh hÆ¡n
- **Cáº£i thiá»‡n tráº£i nghiá»‡m**: Sá»­ dá»¥ng AI Ä‘á»ƒ táº¡o lá»i khuyÃªn thÃ´ng minh
- **Tá»‘i Æ°u hÃ³a tÃ¬m kiáº¿m**: Giáº£m thá»i gian tÃ¬m kiáº¿m phÃ²ng phÃ¹ há»£p

---

## 2. CÃ”NG NGHá»† Sá»¬ Dá»¤NG

### 2.1. Backend
- **Node.js/Express.js**: Framework xÃ¢y dá»±ng API
- **MongoDB/Mongoose**: LÆ°u trá»¯ vÃ  truy váº¥n dá»¯ liá»‡u
- **OpenAI GPT-4o-mini**: Táº¡o AI insights cÃ¡ nhÃ¢n hÃ³a

### 2.2. Frontend
- **React.js**: Framework giao diá»‡n ngÆ°á»i dÃ¹ng
- **TanStack Query**: Quáº£n lÃ½ state vÃ  caching
- **Zustand**: Quáº£n lÃ½ authentication state

---

## 3. LUá»’NG HOáº T Äá»˜NG

### 3.1. SÆ¡ Ä‘á»“ tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Ä‘Äƒng nháº­p â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Personalized      â”‚
â”‚ Recommendations Component   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gá»i API: GET                â”‚
â”‚ /api/ai/personalized-        â”‚
â”‚ recommendations?limit=6      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Kiá»ƒm tra           â”‚
â”‚ Authentication (JWT)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Láº¥y lá»‹ch sá»­ booking         â”‚
â”‚ (10 booking gáº§n nháº¥t)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
         â–¼                     â–¼
    CÃ“ Lá»ŠCH Sá»¬            KHÃ”NG CÃ“
         â”‚                     â”‚
         â”‚                     â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚ Tráº£ vá» phÃ²ng     â”‚
         â”‚              â”‚ phá»• biáº¿n         â”‚
         â”‚              â”‚ (top-rated)      â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHÃ‚N TÃCH Sá» THÃCH          â”‚
â”‚ - ThÃ nh phá»‘                 â”‚
â”‚ - Má»©c giÃ¡                   â”‚
â”‚ - Loáº¡i phÃ²ng                â”‚
â”‚ - Tiá»‡n nghi                 â”‚
â”‚ - Sá»‘ khÃ¡ch                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RÃšT TRÃCH Sá» THÃCH HÃ€NG Äáº¦U â”‚
â”‚ - Top 3 thÃ nh phá»‘            â”‚
â”‚ - Top 2 loáº¡i phÃ²ng           â”‚
â”‚ - GiÃ¡ trung bÃ¬nh             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ XÃ‚Y Dá»°NG QUERY TÃŒM KIáº¾M     â”‚
â”‚ - Lá»c theo thÃ nh phá»‘        â”‚
â”‚ - Lá»c theo loáº¡i phÃ²ng        â”‚
â”‚ - Lá»c theo giÃ¡ (Â±30%)        â”‚
â”‚ - Loáº¡i trá»« phÃ²ng Ä‘Ã£ Ä‘áº·t      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TÃŒM PHÃ’NG Gá»¢I Ã             â”‚
â”‚ Sáº¯p xáº¿p theo rating          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
         â–¼                     â–¼
    Äá»¦ PHÃ’NG              THIáº¾U PHÃ’NG
         â”‚                     â”‚
         â”‚                     â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚ Má»Ÿ rá»™ng tÃ¬m kiáº¿m â”‚
         â”‚              â”‚ (Â±50% giÃ¡)        â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gá»ŒI OPENAI GPT-4o-mini      â”‚
â”‚ Táº¡o AI Insights             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRáº¢ Vá»€ Káº¾T QUáº¢              â”‚
â”‚ - Danh sÃ¡ch phÃ²ng            â”‚
â”‚ - Sá»Ÿ thÃ­ch ngÆ°á»i dÃ¹ng        â”‚
â”‚ - AI Insights                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Hiá»ƒn thá»‹           â”‚
â”‚ - AI Insights                â”‚
â”‚ - Sá»Ÿ thÃ­ch                   â”‚
â”‚ - Danh sÃ¡ch phÃ²ng            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. CHI TIáº¾T Xá»¬ LÃ

### 4.1. Thu tháº­p dá»¯ liá»‡u

**BÆ°á»›c 1: Láº¥y lá»‹ch sá»­ booking**
```javascript
const userBookings = await Booking.find({ userId })
  .populate({
    path: 'roomId',
    populate: { path: 'hotelId' }
  })
  .sort('-createdAt')
  .limit(10);
```

**Dá»¯ liá»‡u thu tháº­p:**
- Danh sÃ¡ch booking (tá»‘i Ä‘a 10 gáº§n nháº¥t)
- ThÃ´ng tin phÃ²ng (roomId) vá»›i Ä‘áº§y Ä‘á»§ chi tiáº¿t
- ThÃ´ng tin khÃ¡ch sáº¡n (hotelId) bao gá»“m thÃ nh phá»‘, Ä‘á»‹a chá»‰

**Xá»­ lÃ½ trÆ°á»ng há»£p khÃ´ng cÃ³ lá»‹ch sá»­:**
- Náº¿u `userBookings.length === 0`
- Tráº£ vá» phÃ²ng phá»• biáº¿n (top-rated)
- `isPersonalized: false`
- KhÃ´ng cÃ³ AI insights

---

### 4.2. PhÃ¢n tÃ­ch sá»Ÿ thÃ­ch

Há»‡ thá»‘ng phÃ¢n tÃ­ch 5 yáº¿u tá»‘ chÃ­nh:

#### 4.2.1. ThÃ nh phá»‘ yÃªu thÃ­ch
```javascript
// Äáº¿m sá»‘ láº§n Ä‘áº·t phÃ²ng á»Ÿ má»—i thÃ nh phá»‘
if (hotel?.city) {
  preferences.cities[hotel.city] = (preferences.cities[hotel.city] || 0) + 1;
}
```

**VÃ­ dá»¥:**
- ÄÃ  Náºµng: 3 láº§n
- HÃ  Ná»™i: 2 láº§n
- Há»“ ChÃ­ Minh: 1 láº§n

#### 4.2.2. Má»©c giÃ¡
```javascript
// TÃ­nh min, max, vÃ  trung bÃ¬nh
const price = room.finalPrice || room.price;
preferences.priceRange.min = Math.min(preferences.priceRange.min, price);
preferences.priceRange.max = Math.max(preferences.priceRange.max, price);
totalPrice += price;
preferences.priceRange.avg = totalPrice / bookingCount;
```

**VÃ­ dá»¥:**
- Min: 1.000.000 VNÄ
- Max: 2.000.000 VNÄ
- Avg: 1.500.000 VNÄ

#### 4.2.3. Loáº¡i phÃ²ng
```javascript
// Äáº¿m táº§n suáº¥t má»—i loáº¡i phÃ²ng
if (room.roomType) {
  preferences.roomTypes[room.roomType] = 
    (preferences.roomTypes[room.roomType] || 0) + 1;
}
```

**VÃ­ dá»¥:**
- Deluxe: 4 láº§n
- Suite: 1 láº§n
- Double: 1 láº§n

#### 4.2.4. Tiá»‡n nghi
```javascript
// Äáº¿m táº§n suáº¥t má»—i tiá»‡n nghi
room.amenities.forEach(amenity => {
  preferences.amenities[amenity] = 
    (preferences.amenities[amenity] || 0) + 1;
});
```

**VÃ­ dá»¥:**
- WiFi: 6 láº§n
- TV: 5 láº§n
- Mini bar: 4 láº§n

#### 4.2.5. Sá»‘ khÃ¡ch tá»‘i Ä‘a
```javascript
// Láº¥y sá»‘ khÃ¡ch tá»‘i Ä‘a cao nháº¥t
if (room.maxGuests) {
  preferences.maxGuests = Math.max(preferences.maxGuests, room.maxGuests);
}
```

**VÃ­ dá»¥:** 4 ngÆ°á»i

---

### 4.3. RÃºt trÃ­ch sá»Ÿ thÃ­ch hÃ ng Ä‘áº§u

**Top 3 thÃ nh phá»‘ yÃªu thÃ­ch:**
```javascript
const favoriteCities = Object.entries(preferences.cities)
  .sort((a, b) => b[1] - a[1])  // Sáº¯p xáº¿p giáº£m dáº§n
  .slice(0, 3)                   // Láº¥y top 3
  .map(([city]) => city);
```

**Top 2 loáº¡i phÃ²ng yÃªu thÃ­ch:**
```javascript
const favoriteRoomTypes = Object.entries(preferences.roomTypes)
  .sort((a, b) => b[1] - a[1])  // Sáº¯p xáº¿p giáº£m dáº§n
  .slice(0, 2)                  // Láº¥y top 2
  .map(([type]) => type);
```

**Káº¿t quáº£ vÃ­ dá»¥:**
- `favoriteCities`: ['ÄÃ  Náºµng', 'HÃ  Ná»™i', 'Há»“ ChÃ­ Minh']
- `favoriteRoomTypes`: ['deluxe', 'suite']

---

### 4.4. XÃ¢y dá»±ng query tÃ¬m kiáº¿m

**Query cÆ¡ báº£n:**
```javascript
const query = {
  isActive: true,              // Chá»‰ phÃ²ng Ä‘ang hoáº¡t Ä‘á»™ng
  availability: true,          // Chá»‰ phÃ²ng cÃ²n trá»‘ng
  _id: { 
    $nin: userBookings.map(b => b.roomId?._id) 
  }  // Loáº¡i trá»« phÃ²ng Ä‘Ã£ Ä‘áº·t
};
```

**Lá»c theo giÃ¡ (linh hoáº¡t Â±30%):**
```javascript
if (preferences.priceRange.avg > 0) {
  const priceFlexibility = 0.3;
  query.price = {
    $gte: preferences.priceRange.avg * (1 - priceFlexibility), // 70%
    $lte: preferences.priceRange.avg * (1 + priceFlexibility)  // 130%
  };
}
```

**VÃ­ dá»¥:** GiÃ¡ trung bÃ¬nh 1.500.000 VNÄ
- Min: 1.050.000 VNÄ (70%)
- Max: 1.950.000 VNÄ (130%)

**Lá»c theo loáº¡i phÃ²ng:**
```javascript
if (favoriteRoomTypes.length > 0) {
  query.roomType = { $in: favoriteRoomTypes };
}
```

**Lá»c theo thÃ nh phá»‘:**
```javascript
if (favoriteCities.length > 0) {
  const hotels = await Hotel.find({ 
    city: { $in: favoriteCities }
  }).select('_id');
  query.hotelId = { $in: hotels.map(h => h._id) };
}
```

---

### 4.5. TÃ¬m phÃ²ng gá»£i Ã½

**TÃ¬m kiáº¿m chÃ­nh:**
```javascript
let recommendedRooms = await Room.find(query)
  .populate('hotelId')
  .sort('-rating')  // Sáº¯p xáº¿p theo rating cao nháº¥t
  .limit(limit);    // Giá»›i háº¡n sá»‘ lÆ°á»£ng
```

**Xá»­ lÃ½ khi khÃ´ng Ä‘á»§ phÃ²ng:**
```javascript
if (recommendedRooms.length < limit) {
  // Má»Ÿ rá»™ng tÃ¬m kiáº¿m vá»›i tiÃªu chÃ­ linh hoáº¡t hÆ¡n
  const additionalQuery = {
    isActive: true,
    availability: true,
    price: {
      $gte: preferences.priceRange.avg * 0.5,  // 50%
      $lte: preferences.priceRange.avg * 1.5   // 150%
    }
  };
  
  const additionalRooms = await Room.find(additionalQuery)
    .populate('hotelId')
    .sort('-rating')
    .limit(limit - recommendedRooms.length);
  
  recommendedRooms = [...recommendedRooms, ...additionalRooms];
}
```

---

### 4.6. Táº¡o AI Insights báº±ng OpenAI

**BÆ°á»›c 1: Táº¡o user summary**
```javascript
const userSummary = `
KhÃ¡ch hÃ ng Ä‘Ã£ Ä‘áº·t ${userBookings.length} láº§n.
ThÃ nh phá»‘ yÃªu thÃ­ch: ${favoriteCities.join(', ')}
Loáº¡i phÃ²ng Æ°a thÃ­ch: ${favoriteRoomTypes.join(', ')}
Má»©c giÃ¡ trung bÃ¬nh: ${Math.round(preferences.priceRange.avg).toLocaleString()} VNÄ
Sá»‘ khÃ¡ch tá»‘i Ä‘a: ${preferences.maxGuests} ngÆ°á»i
`;
```

**BÆ°á»›c 2: Gá»i OpenAI API**
```javascript
const OpenAI = require('openai');
const openai = new OpenAI({ apiKey: config.openaiApiKey });

const completion = await openai.chat.completions.create({
  model: 'gpt-4o-mini',
  messages: [
    {
      role: 'system',
      content: 'Báº¡n lÃ  chuyÃªn gia tÆ° váº¥n du lá»‹ch thÃ´ng minh. PhÃ¢n tÃ­ch sá»Ÿ thÃ­ch cá»§a khÃ¡ch hÃ ng vÃ  Ä‘Æ°a ra lá»i khuyÃªn cÃ¡ nhÃ¢n hÃ³a ngáº¯n gá»n (2-3 cÃ¢u).'
    },
    {
      role: 'user',
      content: `Dá»±a vÃ o lá»‹ch sá»­: ${userSummary}\n\nÄÆ°a ra lá»i khuyÃªn cÃ¡ nhÃ¢n hÃ³a cho khÃ¡ch hÃ ng nÃ y.`
    }
  ],
  max_tokens: 150,
  temperature: 0.7
});

aiInsights = completion.choices[0].message.content;
```

**VÃ­ dá»¥ AI Insights:**
> "Dá»±a trÃªn lá»‹ch sá»­ Ä‘áº·t phÃ²ng cá»§a báº¡n, báº¡n thÆ°á»ng chá»n phÃ²ng á»Ÿ ÄÃ  Náºµng vÃ  HÃ  Ná»™i vá»›i má»©c giÃ¡ khoáº£ng 1.500.000 VNÄ. ChÃºng tÃ´i gá»£i Ã½ báº¡n thá»­ cÃ¡c khÃ¡ch sáº¡n view biá»ƒn á»Ÿ ÄÃ  Náºµng hoáº·c khu vá»±c trung tÃ¢m HÃ  Ná»™i Ä‘á»ƒ cÃ³ tráº£i nghiá»‡m tÆ°Æ¡ng tá»±."

---

## 5. API ENDPOINT

### 5.1. ThÃ´ng tin endpoint

**URL:** `GET /api/ai/personalized-recommendations`

**Authentication:** Required (JWT Token)

**Query Parameters:**
- `limit` (optional): Sá»‘ lÆ°á»£ng phÃ²ng gá»£i Ã½ (máº·c Ä‘á»‹nh: 6)

**Request Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

### 5.2. Response Format

**Success Response (200 OK):**
```json
{
  "success": true,
  "message": "Gá»£i Ã½ phÃ²ng dá»±a trÃªn sá»Ÿ thÃ­ch cá»§a báº¡n",
  "isPersonalized": true,
  "preferences": {
    "favoriteCities": ["ÄÃ  Náºµng", "HÃ  Ná»™i", "Há»“ ChÃ­ Minh"],
    "favoriteRoomTypes": ["deluxe", "suite"],
    "averagePrice": 1500000,
    "bookingCount": 5
  },
  "aiInsights": "Dá»±a trÃªn lá»‹ch sá»­ Ä‘áº·t phÃ²ng cá»§a báº¡n...",
  "data": [
    {
      "_id": "...",
      "name": "PhÃ²ng Deluxe View Biá»ƒn",
      "price": 1800000,
      "roomType": "deluxe",
      "hotelId": {
        "_id": "...",
        "name": "Grand Hotel ÄÃ  Náºµng",
        "city": "ÄÃ  Náºµng"
      },
      ...
    }
  ]
}
```

**Error Response (401 Unauthorized):**
```json
{
  "success": false,
  "message": "Unauthorized"
}
```

**Error Response (500 Internal Server Error):**
```json
{
  "success": false,
  "message": "Server error"
}
```

---

## 6. GIAO DIá»†N NGÆ¯á»œI DÃ™NG

### 6.1. Component Frontend

**File:** `frontend/src/components/PersonalizedRecommendations.jsx`

**Äiá»u kiá»‡n hiá»ƒn thá»‹:**
- Chá»‰ hiá»ƒn thá»‹ khi user Ä‘Ã£ Ä‘Äƒng nháº­p
- Tá»± Ä‘á»™ng fetch khi component mount
- Cache káº¿t quáº£ trong 5 phÃºt

### 6.2. CÃ¡c pháº§n hiá»ƒn thá»‹

#### 6.2.1. Header Section
- Icon robot vá»›i animation
- TiÃªu Ä‘á»: "Gá»£i Ã½ dÃ nh riÃªng cho báº¡n"
- MÃ´ táº£ ngáº¯n gá»n

#### 6.2.2. AI Insights Section
- Hiá»ƒn thá»‹ lá»i khuyÃªn tá»« AI (náº¿u cÃ³)
- Icon bÃ³ng Ä‘Ã¨n
- Background gradient Ä‘áº¹p máº¯t

#### 6.2.3. User Preferences Section
- **ThÃ nh phá»‘ yÃªu thÃ­ch**: Hiá»ƒn thá»‹ top 3 thÃ nh phá»‘
- **Má»©c giÃ¡ trung bÃ¬nh**: Hiá»ƒn thá»‹ giÃ¡ trung bÃ¬nh
- **Loáº¡i phÃ²ng Æ°a thÃ­ch**: Hiá»ƒn thá»‹ top 2 loáº¡i phÃ²ng
- **Sá»‘ láº§n Ä‘áº·t phÃ²ng**: Hiá»ƒn thá»‹ tá»•ng sá»‘ booking

#### 6.2.4. Recommended Rooms Section
- Grid layout (3 cá»™t trÃªn desktop)
- Má»—i phÃ²ng hiá»ƒn thá»‹ báº±ng component `RoomCard`
- Animation fade-in khi load
- Link Ä‘áº¿n trang chi tiáº¿t phÃ²ng

---

## 7. VÃ Dá»¤ THá»°C Táº¾

### 7.1. Scenario 1: User cÃ³ lá»‹ch sá»­ Ä‘áº·t phÃ²ng

**Input:**
- User ID: `507f1f77bcf86cd799439011`
- Lá»‹ch sá»­ booking: 5 láº§n
  - ÄÃ  Náºµng (Deluxe): 3 láº§n, giÃ¡ 1.200.000 - 1.800.000 VNÄ
  - HÃ  Ná»™i (Suite): 2 láº§n, giÃ¡ 2.000.000 - 2.500.000 VNÄ

**Xá»­ lÃ½:**
1. PhÃ¢n tÃ­ch sá»Ÿ thÃ­ch:
   - ThÃ nh phá»‘: ÄÃ  Náºµng (3), HÃ  Ná»™i (2)
   - Loáº¡i phÃ²ng: Deluxe (3), Suite (2)
   - GiÃ¡ trung bÃ¬nh: 1.700.000 VNÄ

2. RÃºt trÃ­ch:
   - Top 3 thÃ nh phá»‘: ['ÄÃ  Náºµng', 'HÃ  Ná»™i']
   - Top 2 loáº¡i phÃ²ng: ['deluxe', 'suite']
   - GiÃ¡ trung bÃ¬nh: 1.700.000 VNÄ

3. Query tÃ¬m kiáº¿m:
   - ThÃ nh phá»‘: ÄÃ  Náºµng hoáº·c HÃ  Ná»™i
   - Loáº¡i phÃ²ng: Deluxe hoáº·c Suite
   - GiÃ¡: 1.190.000 - 2.210.000 VNÄ (Â±30%)

4. AI Insights:
   > "Báº¡n thÆ°á»ng chá»n phÃ²ng Deluxe á»Ÿ ÄÃ  Náºµng vÃ  Suite á»Ÿ HÃ  Ná»™i vá»›i má»©c giÃ¡ khoáº£ng 1.7 triá»‡u. ChÃºng tÃ´i gá»£i Ã½ báº¡n thá»­ cÃ¡c khÃ¡ch sáº¡n view biá»ƒn á»Ÿ ÄÃ  Náºµng hoáº·c khu vá»±c trung tÃ¢m HÃ  Ná»™i Ä‘á»ƒ cÃ³ tráº£i nghiá»‡m tÆ°Æ¡ng tá»±."

**Output:**
- 6 phÃ²ng gá»£i Ã½ phÃ¹ há»£p vá»›i sá»Ÿ thÃ­ch
- Hiá»ƒn thá»‹ sá»Ÿ thÃ­ch ngÆ°á»i dÃ¹ng
- AI insights cÃ¡ nhÃ¢n hÃ³a

---

### 7.2. Scenario 2: User má»›i (chÆ°a cÃ³ lá»‹ch sá»­)

**Input:**
- User ID: `507f1f77bcf86cd799439012`
- Lá»‹ch sá»­ booking: 0 láº§n

**Xá»­ lÃ½:**
1. Kiá»ƒm tra: `userBookings.length === 0`
2. Tráº£ vá» phÃ²ng phá»• biáº¿n (top-rated)
3. KhÃ´ng cÃ³ AI insights
4. `isPersonalized: false`

**Output:**
- 6 phÃ²ng phá»• biáº¿n (sáº¯p xáº¿p theo rating)
- Message: "Gá»£i Ã½ phÃ²ng phá»• biáº¿n cho khÃ¡ch hÃ ng má»›i"
- KhÃ´ng hiá»ƒn thá»‹ sá»Ÿ thÃ­ch

---

## 8. Tá»I Æ¯U HÃ“A VÃ€ HIá»†U NÄ‚NG

### 8.1. Caching
- **Frontend**: Cache káº¿t quáº£ trong 5 phÃºt (staleTime: 5 * 60 * 1000)
- **Backend**: KhÃ´ng cache (luÃ´n tÃ­nh toÃ¡n má»›i Ä‘á»ƒ Ä‘áº£m báº£o Ä‘á»™ chÃ­nh xÃ¡c)

### 8.2. Query Optimization
- Giá»›i háº¡n sá»‘ lÆ°á»£ng booking phÃ¢n tÃ­ch: 10 booking gáº§n nháº¥t
- Sá»­ dá»¥ng MongoDB indexes cho cÃ¡c trÆ°á»ng thÆ°á»ng query
- Populate chá»‰ cÃ¡c trÆ°á»ng cáº§n thiáº¿t

### 8.3. Error Handling
- Xá»­ lÃ½ lá»—i khi khÃ´ng cÃ³ OpenAI API key (bá» qua AI insights)
- Xá»­ lÃ½ lá»—i khi khÃ´ng Ä‘á»§ phÃ²ng (má»Ÿ rá»™ng tÃ¬m kiáº¿m)
- Fallback vá» phÃ²ng phá»• biáº¿n khi cÃ³ lá»—i

---

## 9. Báº¢O Máº¬T

### 9.1. Authentication
- YÃªu cáº§u JWT token há»£p lá»‡
- Chá»‰ user Ä‘Ã£ Ä‘Äƒng nháº­p má»›i cÃ³ thá»ƒ sá»­ dá»¥ng
- Middleware `protect` kiá»ƒm tra authentication

### 9.2. Data Privacy
- Chá»‰ phÃ¢n tÃ­ch dá»¯ liá»‡u cá»§a chÃ­nh user Ä‘Ã³
- KhÃ´ng chia sáº» thÃ´ng tin giá»¯a cÃ¡c user
- AI insights chá»‰ dá»±a trÃªn dá»¯ liá»‡u cá»§a user hiá»‡n táº¡i

---

## 10. Káº¾T LUáº¬N

### 10.1. Æ¯u Ä‘iá»ƒm
âœ… **CÃ¡ nhÃ¢n hÃ³a cao**: Dá»±a trÃªn lá»‹ch sá»­ thá»±c táº¿ cá»§a tá»«ng user  
âœ… **ThÃ´ng minh**: Sá»­ dá»¥ng AI Ä‘á»ƒ táº¡o lá»i khuyÃªn  
âœ… **Linh hoáº¡t**: Tá»± Ä‘á»™ng má»Ÿ rá»™ng tÃ¬m kiáº¿m khi khÃ´ng Ä‘á»§ káº¿t quáº£  
âœ… **Hiá»‡u nÄƒng tá»‘t**: Cache vÃ  tá»‘i Æ°u query  
âœ… **User-friendly**: Giao diá»‡n Ä‘áº¹p, dá»… sá»­ dá»¥ng  

### 10.2. Háº¡n cháº¿
âš ï¸ YÃªu cáº§u user pháº£i cÃ³ lá»‹ch sá»­ Ä‘áº·t phÃ²ng Ä‘á»ƒ cÃ³ gá»£i Ã½ chÃ­nh xÃ¡c  
âš ï¸ Phá»¥ thuá»™c vÃ o OpenAI API (cáº§n API key)  
âš ï¸ Chi phÃ­ API khi cÃ³ nhiá»u user sá»­ dá»¥ng  

### 10.3. HÆ°á»›ng phÃ¡t triá»ƒn
ğŸ”® PhÃ¢n tÃ­ch thÃªm cÃ¡c yáº¿u tá»‘: mÃ¹a, thá»i gian, Ä‘Ã¡nh giÃ¡  
ğŸ”® Machine Learning Ä‘á»ƒ cáº£i thiá»‡n Ä‘á»™ chÃ­nh xÃ¡c  
ğŸ”® A/B testing Ä‘á»ƒ tá»‘i Æ°u thuáº­t toÃ¡n  
ğŸ”® ThÃªm gá»£i Ã½ dá»±a trÃªn collaborative filtering  

---

**TÃ i liá»‡u Ä‘Æ°á»£c táº¡o bá»Ÿi:** Há»‡ thá»‘ng Äáº·t phÃ²ng KhÃ¡ch sáº¡n  
**NgÃ y:** 2025  
**PhiÃªn báº£n:** 1.0

